<?php namespace ZN\Services\Remote;

use CLController;

class RemoteCommon extends CLController implements RemoteCommonInterface
{
    //--------------------------------------------------------------------------------------------------------
    //
    // Author     : Ozan UYKUN <ozanbote@gmail.com>
    // Site       : www.znframework.com
    // License    : The MIT License
    // Copyright  : (c) 2012-2016, znframework.com
    //
    //--------------------------------------------------------------------------------------------------------

    //--------------------------------------------------------------------------------------------------------
    // Path
    //--------------------------------------------------------------------------------------------------------
    //
    // @var string
    //
    //--------------------------------------------------------------------------------------------------------
    protected $path;

    //--------------------------------------------------------------------------------------------------------
    // String Command
    //--------------------------------------------------------------------------------------------------------
    //
    // @var string
    //
    //--------------------------------------------------------------------------------------------------------
    protected $stringCommand;

    //--------------------------------------------------------------------------------------------------------
    // Command
    //--------------------------------------------------------------------------------------------------------
    //
    // @var string
    //
    //--------------------------------------------------------------------------------------------------------
    protected $command;

    //--------------------------------------------------------------------------------------------------------
    // String Command
    //--------------------------------------------------------------------------------------------------------
    //
    // @param void
    //
    //--------------------------------------------------------------------------------------------------------
    public function stringCommand() : String
    {
        return $this->stringCommand;
    }

    //--------------------------------------------------------------------------------------------------------
    // Protected Controller
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $path
    //
    //--------------------------------------------------------------------------------------------------------
    protected function _controller($path)
    {
        $datas = \ZN\Core\Structure::data($path);

        $controller = $datas['page'];
        $function   = $datas['function'] ?? 'main';
        $namespace  = $datas['namespace'];
        $parameters = $datas['parameters'];
        $class      = $namespace . $controller;
        $file       = str_replace('\\', '\\\\', $datas['file']);

        $command    = 'import("'.$file.'");';
        $command   .= 'uselib("'.$class.'")->'.$function.'('. implode(',', \Arrays::map('Processor::addNail', $parameters)) .')';

        return $command;
    }

    //--------------------------------------------------------------------------------------------------------
    // Protected PHP
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $path
    //
    //--------------------------------------------------------------------------------------------------------
    protected function _php($command, $path = NULL)
    {
        $phpCommand = "require_once '".REAL_BASE_DIR."zerocore'; ".$command.";";
        $phpCommand = presuffix(str_replace('"', '\"', $phpCommand), '"');
        $commands   = $path;
        $commands  .= ' -r ';
        $commands  .= $phpCommand;

        return $commands;
    }
}
